import React, { useState } from 'react';
import { ResearchCenter } from '@/assets/projectData';

interface BrazilMapProps {
  centers: ResearchCenter[];
  title: string;
  onAddCenter?: (center: ResearchCenter) => void;
  onRemoveCenter?: (id: number) => void;
  editable?: boolean;
}

const BrazilMap: React.FC<BrazilMapProps> = ({ 
  centers, 
  title,
  onAddCenter,
  onRemoveCenter,
  editable = false
}) => {
  const [selectedCenter, setSelectedCenter] = useState<ResearchCenter | null>(null);
  const [showAddForm, setShowAddForm] = useState(false);
  const [newCenter, setNewCenter] = useState<Partial<ResearchCenter>>({
    name: '',
    city: '',
    state: '',
    latitude: 0,
    longitude: 0,
    description: ''
  });

  // SVG map dimensions and positioning
  const mapWidth = 600;
  const mapHeight = 600;
  const viewBox = "0 0 800 800";
  const mapScale = 0.8;
  const mapTranslateX = 120;
  const mapTranslateY = 30;

  // Handle marker click to show info
  const handleMarkerClick = (center: ResearchCenter) => {
    setSelectedCenter(center);
  };

  // Close info panel
  const handleCloseInfo = () => {
    setSelectedCenter(null);
  };

  // Handle remove center
  const handleRemoveCenter = (id: number) => {
    if (onRemoveCenter) {
      onRemoveCenter(id);
    }
    if (selectedCenter?.id === id) {
      setSelectedCenter(null);
    }
  };

  // Handle change in new center form
  const handleNewCenterChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setNewCenter(prev => ({
      ...prev,
      [name]: name === 'latitude' || name === 'longitude' ? parseFloat(value) : value
    }));
  };

  // Handle submit for new center
  const handleSubmitNewCenter = (e: React.FormEvent) => {
    e.preventDefault();
    if (
      onAddCenter && 
      newCenter.name && 
      newCenter.city && 
      newCenter.state && 
      typeof newCenter.latitude === 'number' && 
      typeof newCenter.longitude === 'number'
    ) {
      onAddCenter({
        id: Date.now(), // Use timestamp as temporary ID
        name: newCenter.name,
        city: newCenter.city,
        state: newCenter.state,
        latitude: newCenter.latitude,
        longitude: newCenter.longitude,
        description: newCenter.description
      });
      
      // Reset form
      setNewCenter({
        name: '',
        city: '',
        state: '',
        latitude: 0,
        longitude: 0,
        description: ''
      });
      setShowAddForm(false);
    }
  };

  // Scale coordinates to SVG map
  const scaleCoordinates = (lat: number, lng: number) => {
    // Brazil spans from approx. -33 to 5 latitude and -74 to -35 longitude
    // Transform these ranges to fit within our SVG
    const x = ((lng + 74) / (74 - 35)) * mapWidth;
    const y = mapHeight - ((lat + 33) / (33 - 5)) * mapHeight;
    return { x, y };
  };

  return (
    <div className="relative w-full max-w-5xl mx-auto">
      <h3 className="text-xl font-bold mb-4 text-center">{title}</h3>
      
      <div className="flex flex-col lg:flex-row gap-6">
        {/* SVG Map */}
        <div className="relative flex-1 border bg-white rounded-lg shadow-md overflow-hidden">
          <svg 
            width="100%" 
            height="100%" 
            viewBox={viewBox} 
            style={{ minHeight: "400px" }}
          >
            <g transform={`translate(${mapTranslateX}, ${mapTranslateY}) scale(${mapScale})`}>
              {/* Brazil Map SVG Path */}
              <path
                d="M227.34,289.43 L216.64,287.59 L216.64,287.59 L212.47,295.02 L208.46,299.52 L198.98,299.52 L197.3,306.44 L191.38,308.45 L187.82,314.54 L185.29,323.81 L180.78,327.14 L175.37,326.99 L171.86,330.98 L168.52,331.48 L166.5,330.48 L162.99,332.99 L162.99,332.99 L164.66,338.08 L162.66,340.09 L162.66,345.17 L157.41,349.84 L157.41,349.84 L157.74,357.26 L155.73,359.78 L152.56,360.61 L152.06,361.95 L152.06,361.95 L146.05,368.62 L145.71,374.37 L149.89,379.62 L152.41,380.12 L153.74,382.14 L153.74,382.14 L157.08,382.14 L160.75,383.3 L164.25,382.47 L171.35,384.14 L175.04,382.8 L178.2,381.46 L183.62,381.3 L186.45,383.32 L187.45,387.31 L191.95,390.31 L193.12,389.31 L197.13,388.97 L198.47,390.81 L201.46,390.64 L204.79,387.31 L209.29,388.14 L211.47,390.81 L214.3,390.81 L218.63,387.14 L221.14,388.64 L221.14,390.81 L224.31,392.82 L224.31,392.82 L226.33,388.81 L225.83,383.8 L221.65,380.79 L220.99,376.95 L216.15,374.28 L212.98,368.7 L217.15,367.36 L219.83,361.78 L224.67,357.27 L223.51,351.19 L228.34,348.02 L232.34,348.52 L234.35,346.67 L233.51,343.16 L235.19,336.75 L241.27,337.76 L243.95,337.25 L247.44,334.24 L250.45,334.74 L250.45,334.74 L253.29,334.74 L252.28,335.74 L248.44,335.74 L241.95,337.25 L235.19,336.75 L233.51,343.16 L234.35,346.67 L232.34,348.52 L228.34,348.02 L223.51,351.19 L224.67,357.27 L219.83,361.78 L217.15,367.36 L212.98,368.7 L216.15,374.28 L220.99,376.95 L221.65,380.79 L225.83,383.8 L226.33,388.81 L224.31,392.82 L224.31,392.82 L227.49,391.66 L229.52,394.66 L235.75,397.16 L238.07,400.66 L243.76,403.83 L248.77,408.82 L249.77,413.65 L252.27,414.81 L253.11,416.82 L258.11,419.98 L261.94,423.64 L266.6,422.98 L267.1,427.47 L274.44,430.14 L279.94,429.65 L285.09,432.65 L286.76,437.64 L284.25,438.48 L283.92,441.64 L293.75,444.47 L296.59,447.8 L301.57,449.15 L302.07,451.83 L306.23,452.49 L304.91,458.32 L307.23,459.65 L311.38,457.98 L312.39,459.99 L316.55,458.15 L317.22,454.81 L324.05,453.65 L328.7,449.98 L333.7,450.32 L332.36,452 L328.7,452.66 L325.73,458.99 L328.56,460.99 L326.06,465.49 L328.06,467.33 L325.73,470.49 L328.23,472.33 L328.23,476.66 L332.86,476.66 L334.37,475.83 L336.87,475.83 L339.53,480.16 L339.53,485.32 L342.38,485.82 L342.38,485.82 L342.38,488.99 L338.7,492.31 L339.87,495.64 L342.54,497.65 L342.54,497.65 L344.21,500.82 L345.72,507.65 L351.38,512.14 L351.38,512.14 L347.22,510.89 L347.05,510.13 L343.39,508.32 L337.7,510.48 L331.87,510.31 L326.72,514.83 L320.4,515.15 L316.24,517.67 L319.89,529.08 L321.41,534.06 L323.91,535.89 L325.42,539.89 L325.42,544.88 L320.9,544.88 L319.89,541.4 L319.39,536.39 L317.87,532.91 L316.07,527.91 L307.42,528.75 L298.78,523.92 L294.61,518.76 L291.61,518.68 L280.28,523.92 L274.28,520.26 L272.61,515.58 L267.78,515.09 L265.45,519.09 L261.44,518.42 L256.12,514.25 L254.95,511.09 L248.12,507.76 L247.95,504.75 L241.2,502.42 L241.25,498.58 L235.45,495.25 L234.5,491.25 L227.44,488.25 L224.12,487.75 L222.12,485.92 L216.97,487.58 L214.13,484.42 L209.47,483.25 L203.64,485.08 L199.3,488.75 L194.98,487.92 L190.48,487.92 L186.98,489.25 L181.15,487.58 L177.65,489.08 L177.65,494.25 L175.32,494.75 L174.15,498.75 L171.15,498.75 L169.15,495.92 L163.83,496.42 L162,494.58 L158,497.75 L151.83,499.25 L150.17,500.92 L147.67,500.92 L146.34,503.92 L141.5,504.92 L140.67,510.92 L138.67,512.75 L139.67,517.25 L137.34,518.58 L136.84,523.09 L126,523.09 L125.84,527.25 L128.67,533.08 L126.84,537.09 L126.84,542.08 L131.17,548.58 L131.17,551.58 L135.67,554.08 L135.83,556.08 L142.17,560.58 L141.84,565.25 L139.5,567.58 L135.17,568.58 L129.84,576.58 L125.17,578.75 L121.34,578.58 L120.17,575.75 L112.17,573.42 L105.67,572.25 L97.17,575.42 L98.34,582.91 L100.84,586.25 L100.34,587.92 L101.17,594.42 L103.5,599.08 L102.34,601.58 L98.84,603.58 L96.84,608.08 L86.5,611.58 L84.34,614.42 L81.67,614.92 L79.17,622.09 L81.17,623.92 L79.84,626.09 L79.84,626.09 L88.5,624.42 L92.17,625.75 L95.84,626.25 L99.17,623.75 L102.34,623.92 L104.84,621.42 L111.34,621.92 L114.67,621.09 L116.5,623.25 L122.67,623.25 L124.84,625.75 L130,626.58 L131.84,625.58 L137.17,626.25 L138.5,624.75 L142.84,622.75 L146.84,623.58 L150.67,620.92 L153.84,621.09 L153.34,626.58 L159.17,634.25 L165.17,638.75 L165.17,641.25 L167.34,643.25 L167.34,648.58 L169.34,650.25 L168.67,654.09 L170.67,656.58 L171.17,661.92 L177.67,661.92 L178.67,664.25 L186.84,666.58 L191.5,666.58 L195,669.42 L198.84,668.25 L207.5,668.25 L209.17,665.75 L213.84,665.75 L213.84,665.75 L213.67,662.75 L219.67,662.75 L219.67,662.75 L219.84,661.09 L222.84,658.58 L222.84,658.58 L220.17,660.42 L220,663.58 L214.17,663.75 L214.17,666.58 L214.17,666.58 L214.34,666.58 L214.17,666.58 L214.17,666.58 L209.34,666.58 L207.67,669.08 L199.17,669.08 L194.84,670.25 L190.84,667.42 L186.17,667.42 L178.17,665.08 L176.67,662.75 L170.17,662.75 L169.67,657.42 L167.67,654.92 L168.34,651.08 L166.34,649.42 L166.34,644.08 L164.17,642.08 L164.17,639.58 L158.17,635.08 L152.5,627.42 L152.5,621.92 L150.5,621.75 L146.67,624.42 L142.67,623.58 L138.34,625.58 L137,627.08 L131.67,626.42 L129.83,627.42 L124.67,626.58 L122.5,624.08 L116.33,624.08 L114.5,621.92 L111.17,622.75 L104.67,622.25 L102.17,624.75 L98.84,624.58 L95.5,627.08 L91.83,626.58 L88.17,625.25 L79.5,626.92 L79.5,626.92 L77.83,628.59 L77.83,635.75 L79.67,639.09 L79.67,647.26 L77.67,654.09 L77.67,657.92 L80.33,659.59 L80.33,670.09 L82.33,672.59 L82.33,677.42 L85.5,681.42 L85.5,686.59 L89,688.42 L91.17,695.09 L91.17,698.75 L94.5,698.75 L94.5,702.92 L97.83,704.25 L98.33,715.26 L100.5,715.26 L100.5,715.26 L105.5,715.26 L105.5,709.76 L107.67,709.76 L107.67,704.76 L112.67,700.42 L112.67,696.25 L115.34,694.59 L115.34,689.92 L116.84,689.92 L116.84,686.59 L118.5,686.59 L122.67,682.59 L122.67,676.75 L130.34,670.59 L136.5,666.25 L136.5,664.25 L140.5,660.92 L146.67,658.59 L146.67,658.59 L146.67,658.59 L151.17,657.92 L151.17,657.92 L151.17,657.92 L155.84,656.25 L155.84,656.25 L155.84,656.25 L164.34,654.42 L166.17,651.59 L170.17,650.09 L171,647.25 L173.17,645.25 L178.67,643.92 L180.34,640.92 L184.5,638.25 L184.5,635.75 L186.5,631.75 L190.34,630.92 L190.34,627.75 L195.17,623.58 L198.67,624.08 L198.67,624.08 L198.83,627.25 L203.17,627.25 L203.17,627.25 L202.83,624.25 L199.5,623.75 L195.83,623.25 L191,627.42 L191,630.58 L187.17,631.42 L185.17,635.42 L185.17,637.92 L181,640.58 L179.33,643.58 L173.83,644.91 L171.67,646.91 L170.83,649.75 L166.83,651.25 L165,654.08 L156.5,655.91 L156.5,655.91 L156.5,655.91 L151.83,657.58 L151.83,657.58 L151.83,657.58 L147.33,658.25 L147.33,658.25 L147.33,658.25 L141.17,660.58 L137.17,663.91 L137.17,665.91 L131,670.25 L130.83,676.08 L123.17,682.25 L119,686.25 L117.33,686.25 L117.33,689.58 L115.83,689.58 L115.83,694.25 L113.17,695.91 L113.17,700.08 L108.17,704.42 L108.17,709.42 L106,709.42 L106,714.91 L101,714.91 L101,714.91 L100.84,708.92 L98.67,708.92 L98.17,704.58 L98.17,698.75 L95.5,698.08 L94.84,695.58 L91.5,694.42 L91.67,691.58 L90.34,689.08 L86.5,687.08 L86.5,682.75 L83.33,678.75 L83.33,673.25 L81.5,670.75 L81.5,660.25 L78.5,658.92 L78.5,654.08 L80.5,647.58 L80.5,638.75 L78.83,635.58 L78.83,628.09 L79.84,626.09 L79.84,626.09 L75.17,633.09 L75.17,637.75 L77.17,640.58 L77.17,647.58 L75.17,653.92 L75.17,658.09 L77.84,659.25 L77.84,671.09 L80,673.09 L80,677.92 L83.17,681.75 L83.17,686.58 L86.67,687.92 L88.84,693.58 L89.67,698.75 L93.17,700.58 L93.17,704.75 L97,705.75 L97.17,717.59 L105.84,717.92 L115.84,720.59 L115.84,718.25 L122.67,718.25 L122.67,718.25 L122.67,718.25 L122.84,715.09 L128.17,715.09 L128.17,708.09 L129.84,708.09 L129.84,708.09 L130.17,711.25 L129.17,715.25 L123.84,715.25 L123.67,718.42 L123.67,718.42 L123.67,718.42 L123.17,718.42 L116.5,718.42 L116.5,720.75 L105.67,717.92 L97,717.59 L96.83,705.75 L93,704.75 L93,700.58 L89.5,698.75 L88.67,693.58 L86,687.92 L82.5,686.58 L82.5,681.75 L79.33,677.92 L79.33,673.09 L77.17,671.09 L77.17,659.25 L74.5,658.09 L74.5,653.92 L76.5,647.58 L76.5,640.58 L74.5,637.75 L74.5,633.75 L79.17,622.75 L81.17,616.08 L83.17,614.92 L85.67,611.92 L96,607.92 L98,603.42 L101.5,601.42 L102.67,598.92 L100.33,594.25 L99.5,587.75 L98.67,586.08 L96.17,582.75 L95,575.25 L98.33,573.75 L106.33,570.92 L112.33,572.08 L120.33,574.42 L121.5,577.25 L124.83,577.41 L129.33,574.91 L134.83,566.75 L138.5,565.91 L140.83,563.58 L141.17,558.91 L134.83,554.41 L134.67,552.41 L130.17,549.91 L130.17,546.91 L125.83,540.41 L125.83,535.25 L127.67,531.25 L127.67,530.58 L124.83,524.75 L127.17,521.25 L136.17,521.25 L136.67,516.75 L138.67,515.58 L137.83,512.08 L139.5,510.08 L140.33,504.08 L144.5,503.08 L146.33,499.58 L150.33,498.58 L151.5,497.58 L157.67,496.08 L160.83,493.58 L163,495.08 L168.17,494.58 L170.17,497.41 L172.5,497.41 L173.5,493.75 L175.83,493.25 L175.83,488.08 L179.5,486.58 L182.17,485.58 L188,487.25 L191.5,485.92 L194.83,484.75 L200.17,484.75 L203.17,482.08 L209.83,480.25 L213.67,481.25 L216.33,484.08 L221.5,482.41 L223.5,484.25 L226.83,484.75 L233.83,487.75 L234.83,491.75 L240.63,495.08 L240.5,498.92 L247.33,501.25 L247.5,504.25 L254.33,507.58 L255.5,510.75 L260.83,514.92 L264.83,515.58 L267.17,511.58 L272,512.08 L273.67,516.75 L279.67,520.41 L291,515.17 L294,515.25 L298.17,520.41 L306.67,525.41 L315.17,524.58 L316.83,529.42 L319,533.08 L319.5,538.08 L320.5,541.58 L321.83,544.08 L325.67,544.08 L325.67,544.08 L324.5,541.91 L323.67,536.75 L321.17,534.91 L319.67,529.75 L316.5,519.75 L320.17,517.41 L326.5,517.08 L331.67,512.58 L337.5,512.75 L343,510.58 L346.67,512.41 L348.5,514.75 L348.5,514.75 L349.17,515.92 L354.5,520.58 L359.84,520.75 L360.34,524.08 L362,527.58 L368.67,528.41 L375.17,530.91 L379.84,530.25 L381.67,533.41 L385.34,532.75 L388.5,536.08 L393.17,535.58 L396,536.08 L396.5,532.91 L399.5,534.25 L402.17,533.75 L402.17,537.08 L405.17,539.08 L403.17,540.08 L402.33,543.41 L405.33,546.08 L407.17,548.75 L408.17,552.41 L411.67,551.58 L416.5,553.08 L417.17,555.08 L422.33,556.08 L427.5,560.58 L433.33,561.91 L439.17,567.58 L444.17,568.58 L446.5,570.41 L452.33,570.91 L452.33,570.91 L452.33,570.91 L452.33,570.91 L452.33,570.91 L452.5,570.91 L452.5,568.41 L450.33,568.08 L446.17,566.08 L444.17,563.91 L437.83,561.91 L437.83,561.91 L436.33,561.58 L430.67,555.91 L425.5,554.58 L420.33,553.58 L417.67,552.25 L417,550.25 L412.17,548.75 L408.67,549.58 L407.5,546.91 L405.67,544.25 L402.67,541.58 L403.5,538.25 L405.5,537.25 L402.5,535.25 L402.5,531.91 L399.83,532.41 L396.83,531.08 L396.33,534.25 L393.5,533.75 L388.83,534.25 L385.67,530.91 L382,531.58 L380.17,528.41 L375.5,529.08 L369,526.58 L362.33,525.75 L360.67,522.25 L360.17,518.91 L354.83,518.75 L349.5,514.08 L349.5,514.08 L348.83,512.75 L353.83,513.75 L354.67,509.42 L350,506.58 L350,502.58 L353.33,502.41 L354.5,497.25 L351.5,496.58 L347.5,493.58 L343.33,488.08 L343.33,488.08 L343.33,488.08 L342.54,488.41 L342.54,488.41 L342.54,488.41 L342.71,485.58 L339.87,485.08 L339.87,479.92 L337.2,475.58 L334.7,475.58 L333.2,476.41 L328.57,476.41 L328.57,472.08 L326.06,470.25 L328.4,467.08 L326.4,465.25 L328.9,460.75 L326.06,458.75 L329.07,452.41 L332.7,451.75 L334.04,450.08 L329.04,449.75 L324.4,453.41 L317.56,454.58 L316.89,457.92 L312.72,459.75 L311.72,457.75 L307.56,459.41 L305.24,458.08 L306.56,452.25 L302.4,451.58 L301.9,448.92 L296.9,447.58 L294.07,444.25 L284.25,441.41 L284.59,438.25 L287.09,437.41 L285.42,432.41 L280.25,429.41 L274.77,429.91 L267.44,427.25 L266.94,422.75 L262.27,423.41 L258.44,419.75 L253.44,416.58 L252.6,414.58 L250.1,413.41 L249.1,408.58 L244.1,403.58 L238.4,400.41 L236.08,396.92 L229.85,394.41 L227.83,391.41 L224.64,392.58 L224.64,392.58 L224.31,392.82 L224.31,392.82 L224.31,392.82 L219.98,396.5 L213.14,396.5 L212.31,392.5 L206.8,392.17 L203.8,390.5 L200.8,390.67 L198.14,389.83 L197.3,389 L193.3,389.33 L192.14,390.33 L187.64,387.33 L186.64,383.33 L183.8,381.33 L178.39,381.5 L175.22,382.83 L171.52,384.17 L164.47,382.5 L160.97,383.33 L157.3,382.17 L153.97,382.17 L153.97,382.17 L156.8,385.5 L155.8,390.5 L160.3,397.33 L164.8,397.33 L167.14,398.17 L169.8,396.33 L176.47,399.17 L179.64,394.5 L182.8,396.5 L186.14,395.33 L189.14,401.33 L191.64,403.5 L192.3,407 L195.3,409.33 L192.8,411.33 L194.64,416.83 L193.97,419.33 L195.47,422.5 L194.8,425.33 L196.3,427.5 L196.3,432.5 L195.14,434.67 L193.14,436.17 L193.14,436.17 L192.14,438.67 L192.14,438.67 L191.3,441.33 L191.3,441.33 L190.47,445.5 L192.8,445.5 L192.8,450.17 L194.8,452.33 L197.97,452.33 L197.97,452.33 L202.47,452.33 L202.47,455 L206.64,456.17 L206.64,459.33 L211.14,460.33 L211.14,466.17 L213.14,469.17 L211.47,474.33 L208.97,479.17 L208.3,485.17 L208.3,485.17 L213.47,484.17 L218.97,484.17 L225.14,488.17 L225.14,488.17 L223.3,485.17 L224.64,487 L226.97,487.5 L227.44,488.25 L227.44,488.25 L235.3,491.5 L236.3,495.17 L241.63,498.33 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,497.5 L243.97,501.17 L247.8,503.17 L249.14,504.17 L254.14,507.17 L256.64,510.83 L261.14,515.17 L264.47,515.83 L266.8,511.83 L271.64,512.33 L273.3,517 L279.3,520.67 L290.64,515.42 L293.64,515.5 L297.8,520.67 L306.3,525.67 L314.8,524.83 L316.47,529.67 L318.64,533.33 L319.14,538.33 L320.14,541.83 L321.47,544.33 L325.3,544.33 L325.47,539.33 L323.97,535.33 L321.47,533.5 L319.97,528.33 L316.8,518.33 L320.47,516 L326.8,515.67 L331.97,511.17 L337.8,511.33 L343.3,509.17 L346.97,511 L348.8,513.33 L348.8,513.33 L342.54,497.65 L342.54,497.65 L340.71,496.17 L339.54,492.83 L343.21,489.5 L343.21,485.83 L343.21,485.83 L339.71,485.33 L339.71,480.17 L337.04,475.83 L334.54,475.83 L333.04,476.67 L328.4,476.67 L328.4,472.33 L325.9,470.5 L328.23,467.33 L326.23,465.5 L328.73,460.99 L325.9,459 L328.9,452.67 L332.54,452 L333.87,450.33 L328.87,450 L324.23,453.67 L317.39,454.83 L316.72,458.17 L312.56,460 L311.56,458 L307.39,459.67 L305.07,458.33 L306.39,452.5 L302.23,451.83 L301.73,449.17 L296.73,447.83 L293.9,444.5 L284.07,441.67 L284.42,438.5 L286.92,437.67 L285.25,432.67 L280.09,429.67 L274.6,430.17 L267.27,427.5 L266.77,423 L262.1,423.67 L258.27,420 L253.27,416.83 L252.44,414.83 L249.94,413.67 L248.94,408.83 L243.93,403.83 L238.24,400.67 L235.92,397.17 L229.69,394.67 L227.67,391.67 L224.48,392.83 L224.48,392.83 L222.31,391.67 L222.31,389.5 L219.8,388 L217.8,388 L213.47,391.67 L209.63,391.67 L207.47,389 L202.97,388.17 L199.64,391.5 L196.64,391.67 L195.3,389.83 L191.3,390.17 L190.14,391.17 L185.63,388.17 L184.64,384.17 L181.8,382.17 L176.39,382.33 L173.22,383.67 L169.52,385 L162.47,383.33 L158.97,384.17 L155.3,383 L151.97,383 L151.97,383 L152.06,364.83 L152.56,361.78 L152.56,361.78 L152.52,360.94 L155.69,360.11 L157.7,357.59 L157.36,350.17 L157.36,350.17 L161.7,346.33 L161.7,344.5 L161.7,341.33 L163.7,339.33 L162.03,334.33 L162.03,334.33 L164.19,333.33 L166.19,334.33 L168.19,335.5 L171.53,335 L175.03,331 L180.44,331.17 L184.95,327.83 L187.47,318.55 L191.03,312.47 L196.95,310.46 L198.64,303.53 L208.11,303.53 L212.13,299.05 L216.3,291.61 L216.3,291.61 L227,293.45 L233.66,293.45 L236.33,292.28 L237.33,287.78 L241.16,287.45 L241.16,283.95 L244.16,283.95 L247.82,283.28 L252.99,277.28 L257.82,277.12 L257.82,279.12 L261.99,279.28 L262.66,282.28 L267,282.62 L267,287.28 L270.16,285.12 L274.33,281.79 L275.16,283.79 L278.5,283.79 L282.83,278.12 L289.83,278.12 L289.83,278.12 L287.66,281.46 L288.33,284.62 L292.33,284.79 L294.49,282.79 L299.33,282.79 L300.33,280.46 L307.66,282.79 L309.33,288.29 L318.33,288.46 L321.5,285.96 L326.16,285.79 L330.66,281.79 L331.16,277.96 L329.16,276.96 L329.16,273.13 L330.99,272.13 L330.99,267.46 L328.66,264.63 L330.99,260.63 L330.33,256.13 L328.33,252.96 L328.33,249.13 L325.66,247.13 L325.16,244.13 L323.16,243.3 L322.83,240.13 L320.53,239.85 L318.52,241.85 L316.36,239.52 L313.19,240.35 L311.36,239.35 L309.03,241.68 L305.53,241.68 L304.86,239.68 L306.36,238.02 L305.53,235.02 L299.36,236.35 L297.19,233.52 L293.19,234.18 L290.02,236.68 L287.86,236.52 L287.02,233.52 L276.36,234.68 L274.36,236.85 L271.19,236.35 L268.52,233.68 L264.69,232.18 L260.86,232.68 L260.02,236.52 L254.86,236.85 L254.36,234.68 L257.2,234.02 L256.36,231.85 L253.36,231.35 L252.86,229.35 L247.03,229.35 L245.36,233.02 L242.53,231.35 L240.52,232.52 L239.19,236.68 L235.19,235.52 L232.03,238.18 L228.36,239.68 L224.52,238.02 L223.19,239.35 L219.86,239.02 L216.02,240.35 L214.19,244.52 L210.69,246.85 L210.69,246.85 L209.86,249.52 L207.02,251.35 L205.02,250.18 L202.52,253.35 L197.86,253.35 L197.86,250.68 L194.03,250.68 L191.03,252.85 L188.69,252.68 L187.69,250.52 L184.19,250.68 L184.19,247.85 L179.36,245.18 L174.03,239.85 L172.86,236.52 L167.19,234.35 L162.86,236.02 L159.03,234.18 L155.03,234.52 L153.69,237.52 L149.69,237.52 L148.36,242.35 L145.53,240.18 L142.86,242.52 L142.86,242.52 L144.86,245.35 L143.36,248.35 L141.53,246.35 L139.36,247.35 L138.86,250.35 L136.86,251.35 L136.86,254.35 L134.19,255.85 L134.19,258.68 L130.86,259.01 L130.36,261.35 L127.69,261.68 L127.69,264.01 L124.86,264.01 L124.36,265.01 L125.36,267.01 L124.16,269.01 L126.16,271.01 L127.36,276.18 L128.86,277.18 L128.86,279.68 L132.86,279.18 L132.86,281.68 L138.02,281.35 L142.86,287.01 L144.02,292.01 L148.36,293.01 L153.86,297.51 L157.86,297.51 L160.86,301.01 L161.52,304.01 L165.02,305.01 L168.86,307.18 L171.69,311.01 L174.86,311.01 L175.86,312.51 L183.86,312.68 L183.86,312.68 L182.36,316.68 L180.69,320.01 L178.36,321.51 L176.19,322.01 L173.52,328.51 L175.36,329.68 L179.69,329.68 L183.69,326.68 L187.03,318.01 L190.69,311.68 L196.19,309.68 L197.69,303.18 L209.03,303.18 L212.69,299.01 L216.86,291.35 L216.86,291.35 L227.34,293.18 L227.34,289.43 L227.34,289.43 Z"
                fill="#F2F2F2"
                stroke="#333"
                strokeWidth="2"
              />

              {/* Markers for research centers */}
              {centers.map((center) => {
                const coords = scaleCoordinates(center.latitude, center.longitude);
                return (
                  <g 
                    key={center.id} 
                    transform={`translate(${coords.x}, ${coords.y})`}
                    onClick={() => handleMarkerClick(center)}
                    style={{ cursor: 'pointer' }}
                  >
                    <circle r="8" fill={selectedCenter?.id === center.id ? "#FF5733" : "#3B82F6"} />
                    <circle r="12" stroke="#3B82F6" strokeWidth="2" fill="none" />
                  </g>
                );
              })}
            </g>
          </svg>
        </div>

        {/* Info Panel or Add Center Form */}
        <div className="w-full lg:w-1/3 bg-white rounded-lg p-4 shadow-md">
          {showAddForm ? (
            <div>
              <h4 className="text-lg font-semibold mb-3">Adicionar Novo Centro</h4>
              <form onSubmit={handleSubmitNewCenter}>
                <div className="space-y-3">
                  <div>
                    <label className="block text-sm font-medium mb-1">Nome</label>
                    <input 
                      type="text" 
                      name="name"
                      value={newCenter.name}
                      onChange={handleNewCenterChange}
                      className="w-full border rounded-md px-3 py-2"
                      required
                    />
                  </div>
                  
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-sm font-medium mb-1">Cidade</label>
                      <input 
                        type="text" 
                        name="city"
                        value={newCenter.city}
                        onChange={handleNewCenterChange}
                        className="w-full border rounded-md px-3 py-2"
                        required
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Estado</label>
                      <input 
                        type="text" 
                        name="state"
                        value={newCenter.state}
                        onChange={handleNewCenterChange}
                        className="w-full border rounded-md px-3 py-2"
                        required
                      />
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-sm font-medium mb-1">Latitude</label>
                      <input 
                        type="number" 
                        name="latitude"
                        value={newCenter.latitude || ''}
                        onChange={handleNewCenterChange}
                        className="w-full border rounded-md px-3 py-2"
                        step="0.0001"
                        required
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Longitude</label>
                      <input 
                        type="number" 
                        name="longitude"
                        value={newCenter.longitude || ''}
                        onChange={handleNewCenterChange}
                        className="w-full border rounded-md px-3 py-2"
                        step="0.0001"
                        required
                      />
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium mb-1">Descrição</label>
                    <textarea 
                      name="description"
                      value={newCenter.description || ''}
                      onChange={handleNewCenterChange}
                      className="w-full border rounded-md px-3 py-2"
                      rows={3}
                    />
                  </div>
                  
                  <div className="flex gap-3">
                    <button 
                      type="submit" 
                      className="px-4 py-2 bg-primary text-white rounded-md"
                    >
                      Adicionar
                    </button>
                    <button 
                      type="button" 
                      onClick={() => setShowAddForm(false)}
                      className="px-4 py-2 bg-gray-200 rounded-md"
                    >
                      Cancelar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          ) : selectedCenter ? (
            <div>
              <div className="flex justify-between items-start">
                <h4 className="text-lg font-semibold">{selectedCenter.name}</h4>
                <button 
                  onClick={handleCloseInfo}
                  className="text-gray-400 hover:text-gray-600"
                >
                  ✕
                </button>
              </div>
              <p className="text-gray-600 mt-1">{selectedCenter.city}, {selectedCenter.state}</p>
              <p className="mt-3">{selectedCenter.description || 'Sem descrição disponível.'}</p>
              
              <div className="text-sm text-gray-500 mt-3">
                <p>Latitude: {selectedCenter.latitude}</p>
                <p>Longitude: {selectedCenter.longitude}</p>
              </div>
              
              {editable && onRemoveCenter && (
                <button 
                  className="mt-4 px-3 py-1 bg-red-100 text-red-700 rounded-md text-sm"
                  onClick={() => handleRemoveCenter(selectedCenter.id)}
                >
                  Remover Centro
                </button>
              )}
            </div>
          ) : (
            <div>
              <h4 className="text-lg font-semibold mb-3">Centros de Pesquisa</h4>
              <p className="text-gray-600 mb-4">
                Clique em um marcador no mapa para ver detalhes do centro de pesquisa.
              </p>
              <ul className="space-y-2">
                {centers.map(center => (
                  <li 
                    key={center.id}
                    className="py-2 px-3 bg-gray-50 rounded-md cursor-pointer hover:bg-gray-100"
                    onClick={() => handleMarkerClick(center)}
                  >
                    <span className="font-medium">{center.name}</span>
                    <span className="text-sm text-gray-600 block">{center.city}, {center.state}</span>
                  </li>
                ))}
              </ul>
              
              {editable && onAddCenter && (
                <button 
                  className="mt-4 px-4 py-2 bg-primary text-white rounded-md"
                  onClick={() => setShowAddForm(true)}
                >
                  Adicionar Centro
                </button>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default BrazilMap;